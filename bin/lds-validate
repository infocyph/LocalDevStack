#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
# shellcheck disable=SC1090
source "$ROOT/lib/bootstrap.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/io.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/docker.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/docker_exec.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/env.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/validate.sh"

sub="${1:-all}"
shift || true
case "$sub" in
  env) lds_validate_env "${1:-$ENV_DOCKER}" ;;
  compose) lds_validate_compose ;;
  profiles) lds_validate_profiles ;;
  all) lds_validate_compose && lds_validate_profiles && lds_validate_env "${ENV_DOCKER:-$DIR/docker/.env}" ;;
  *) die "validate <all|compose|env|profiles>" ;;
esac
