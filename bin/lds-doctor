#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
# shellcheck disable=SC1090
source "$ROOT/lib/bootstrap.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/io.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/docker.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/docker_exec.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/env.sh"
# shellcheck disable=SC1090
source "$ROOT/lib/doctor.sh"

sub="${1:-run}"; shift || true
case "$sub" in
  run) lds_doctor_compose_config; lds_doctor_scan_logs; lds_doctor_shellcheck;;
  lint) lds_doctor_shellcheck;;
  scan-logs) lds_doctor_scan_logs;;
  compose) lds_doctor_compose_config;;
  *) die "doctor <run|lint|scan-logs|compose>";;
esac
